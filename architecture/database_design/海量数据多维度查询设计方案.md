问题：海量数据（如订单，资产等），需要按照不同维度去查询（用户维度，商户维度，订单状态）

#### 1 冷热数据划分

数据如果无限增大，需要考虑数据迁移方案，
3个月以内数据作为热数据：使用 Mysql核心库，制定分库分表方案
3个月以前数据作为冷数据：使用 Hive 或者 Es 存储，（需要设计归档/备份方案）如果冷数据也存储在数据库中，成本较高，也不方便维护。如果有特殊查询请求，可以走离线数据查看

#### 2 业务垂直拆分

按照订单的使用者拆分成3个维度
如 客户端 / 商户端 / 渠道端等，分散查询压力，提高客户端的吞吐量，业务之间解耦，用**空间换时间**
用户下单之后，数据只写入客户库，然后发送其他 MQ，商家MQ，和渠道MQ，其他业务线收到MQ之后，在写数据到各自的数据库。

#### 3 数据水平拆分-分表策略

##### 3.1 字段取余方式

客户库可以使用 user_id 作为分表 key，常用的分表策略如 user_id % 64 / 4 * 4 等方案
商家库可以使用产品所属商家进行分库 商户ID % 64 / 4 * 4，以此类推

##### 3.2 字段范围方式

还可以根据id 大小进行分表，如将userId为1~9999的记录分到第一个库，10000~20000的分到第二个库
天然便于水平扩展，后期如果想对整个分片集群扩容时，只需要添加节点即可，无需对其他分片的数据进行迁移

**可能会有一个隐患**
update order set status = 1 where user_id = 10001 and id = 20001; 如果使用了 user_id 索引可能会导致死锁

##### 如何避免热点情况

海量数据情况下，数据的分布理论上也应该是平均的。
特殊业务特殊处理：
海量数据的直播业务，对于主播的订单可以考虑根据看视频的人进行分表，然后完成后，发送MQ，再在主播数据库进行汇总存储（这里可以考虑通过内存缓存机制来进行处理）。

#### 3 分库策略

数据库分表能够解决单表数据量很大的时候数据查询的效率问题，但是无法给数据库的并发操作带来效率上的提高，因为分表的实质还是在同一个数据库Server上进行的操作，很容易受数据库Server IO 性能的限制。

分库策略与分表策略的实现很相似，最简单的都是可以通过取模的方式进行路由。
uid % 数据库数量，如：109005 % 16 = 13，分配到第13个数据库

#### 4 迁移 & 扩容方案

取余方式需要写 JOB 来做历史数据归档，范围分表，天然具有迁移机制
# 分布式唯一主键的要求

1. ［强制］不重复
2. ［强制］分库分表的情况下，能直接根据id定位所在分表
3. 海量数据时的尽可能降低存储压力
4. 字段自有序性
5. 业务表要具有友好的可读性

## 数据库自增ID

### 优点

id自有序，性能也可以接受。

### 缺点

分库分表存在麻烦，解决办法：各个表设置不同的初始值，然后采用相同的步长。
在单个数据库或读写分离或一主多从的情况下，只有一个主库可以生成。有单点故障的风险。

## UUID

### 优点

简单，生成ID性能很好，基本不会有性能问题
全球唯一，对于分布式的场景，可以从容应对

### 缺点

没有插入顺序的排序
字符串存储，查询效率低下(有一些将UUID转换为INT的方法)
存储空间较大，传输数据量大
不可读
分库分表的情况下，无法定位到所在分表，存在死锁隐患。

## Redis

性能比数据库好，基于Redis单线程的特性，主要基于Redis的原子操作 INCR和INCRBY来实现。

## Snowflake

使用41bit作为毫秒数，10bit作为机器的ID（5个bit是数据中心，5个bit的机器ID），12bit作为毫秒内的流水号（意味着每个节点在每毫秒可以产生 4096 个 ID），最后还有一个符号位，永远是0。
优点：
1）不依赖于数据库，灵活方便，且性能优于数据库。
2）ID按照时间在单机上是递增的。
缺点：
1） 在单机上是递增的，但是由于涉及到分布式环境，每台机器上的时钟不可能完全同步，也许有时候也会出现不是全局递增的情况。

雪花算法需要考虑的因素

1. 时间
2. 机器IP
3. 进程PID
4. 业务Type
5. 路由规则
6. 最后需要对上述数据做可逆加密


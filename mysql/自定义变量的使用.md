### 基本语法
1. sql 语句中，使用`@`来定义一个变量。如 `@abc`
2. sql 语句中，使用`:=`来给变量赋值 `@abc:=123`,则变量 abc 的值为 123
3. sql 语句中，`if(A,B,C)`表示，如果 A 条件成立，那么执行 B，否则执行 C，如:
   `@abc := if(2>1,100,200)`的结果是，abc 的值为 100
4. [mysql CASE 语法](https://dev.mysql.com/doc/refman/8.0/en/case.html)

5. `select @cur_rank := 1 && @pre_business_no := 2;`   
该 sql 返回 1 也就是前一个表达式的值


#### 案例1: 根据A字段排序（存在重复），返回A字段递增且【无重复】的一个排名

    select m.sort_no, (@curRank := @curRank + 1) as rank_no
    from main.main m, (select @curRank := 0) q
    order by m.sort_no
    
#### 案例2: 根据A字段排序（存在重复），返回A字段递增且【有重复】的一个排名

    select m.business_num,
      case
        when @pre_business_no = business_num then @curRank
        when @pre_business_no := business_num then @curRank := @curRank + 1
      end as rank_no
    from main.main m, (select @curRank := 0,@pre_business_no := NULL) q
    order by m.business_num;
    
or

    select *
    from (
           select
             m.business_num,
             if(@pre_business_no = m.business_num,
                @cur_rank := @cur_rank + 1,
                @cur_rank := 1) as rank_no,
             @pre_business_no := m.business_num
           from main.main m, (select
                                @cur_rank := 0,
                                @pre_business_no := NULL) q
           order by m.business_num
         ) as rs1
    where rank_no = 1;
    
#### 案例3: 根据A字段分组，只返回当前组内B字段最小的一条记录

    select *
        from (
          select m.id,m.business_num,m.sort_no,
            case
              when @pre_business_no = business_num then @cur_rank := @cur_rank + 1
              else @cur_rank := 1 && @pre_business_no := business_num
            end as rank_no
          from main.main m, (select @cur_rank := 1,@pre_business_no := NULL) q
          order by m.business_num,sort_no) rs
        where rs.rank_no = 1;
    
or 

    select *
    from (
      select m.id,m.business_num,m.sort_no,
        if(@pre_business_no = business_num,@cur_rank := @cur_rank + 1,@cur_rank := 1 && @pre_business_no := business_num)
          as rank_no
      from main.main m, (select @cur_rank := 1,@pre_business_no := NULL) q
      order by m.business_num,sort_no) rs
    where rs.rank_no = 1;

> then / else 表达式后面如果有多个语句，会返回第一个语句的值

###### 附:基本环境脚本
    CREATE TABLE main.main (
      id           BIGINT UNSIGNED  NOT NULL AUTO_INCREMENT,
      business_num TINYINT UNSIGNED NOT NULL,
      sort_no      TINYINT UNSIGNED NOT NULL,
      PRIMARY KEY (id)
    )
      ENGINE = InnoDB
      DEFAULT CHARSET = utf8
      COMMENT = 'main';
    
    INSERT INTO main.main (id, business_num, sort_no) VALUES (1, 1, 10);
    INSERT INTO main.main (id, business_num, sort_no) VALUES (6, 1, 24);
    INSERT INTO main.main (id, business_num, sort_no) VALUES (2, 1, 30);
    INSERT INTO main.main (id, business_num, sort_no) VALUES (13, 1, 30);
    INSERT INTO main.main (id, business_num, sort_no) VALUES (5, 2, 12);
    INSERT INTO main.main (id, business_num, sort_no) VALUES (4, 2, 43);
    INSERT INTO main.main (id, business_num, sort_no) VALUES (3, 2, 50);
    INSERT INTO main.main (id, business_num, sort_no) VALUES (11, 3, 24);
    INSERT INTO main.main (id, business_num, sort_no) VALUES (12, 3, 24);
    INSERT INTO main.main (id, business_num, sort_no) VALUES (10, 3, 25);
    INSERT INTO main.main (id, business_num, sort_no) VALUES (8, 4, 1);
    INSERT INTO main.main (id, business_num, sort_no) VALUES (9, 4, 11);
    INSERT INTO main.main (id, business_num, sort_no) VALUES (7, 4, 56);
    INSERT INTO main.main (id, business_num, sort_no) VALUES (14, 4, 56);





